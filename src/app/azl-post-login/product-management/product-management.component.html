<div class="bg-white rounded-2xl shadow-lg p-6 w-full max-w-5xl mx-auto mt-8">
  <h2 class="text-2xl font-bold mb-6 text-[#91203d] text-center">
    Product Management
  </h2>

  <div class="w-full mt-4">

    <div class="flex items-center border-b border-gray-200 mb-6 text-sm font-medium text-gray-600">
      <button (click)="activeTab = 'categories'" class="px-4 py-2 relative transition-all duration-200" [ngClass]="{
        'text-[#91203d] font-semibold': activeTab === 'categories',
        'text-gray-500 hover:text-[#91203d]': activeTab !== 'categories'
      }">
        Categories
        <div class="absolute left-0 right-0 -bottom-[1px] h-[2px] bg-[#91203d] transition-all duration-300"
          *ngIf="activeTab === 'categories'">
        </div>
      </button>

      <button (click)="activeTab = 'products'" class="ml-4 px-4 py-2 relative transition-all duration-200" [ngClass]="{
        'text-[#91203d] font-semibold': activeTab === 'products',
        'text-gray-500 hover:text-[#91203d]': activeTab !== 'products'
      }">
        Products
        <div class="absolute left-0 right-0 -bottom-[1px] h-[2px] bg-[#91203d] transition-all duration-300"
          *ngIf="activeTab === 'products'">
        </div>
      </button>

      <!-- <div class="flex-1 border-b border-gray-200 ml-4"></div> -->
    </div>

    <div *ngIf="activeTab === 'categories'" class="mt-4 space-y-6">
      <div *ngIf="hasPermission('create_categories')"
        class="bg-gray-50 border border-gray-200 rounded-xl p-5 shadow-sm">
        <p class="text-base font-semibold text-gray-800 mb-4">Create Category</p>

        <div class="flex flex-col space-y-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Category Name</mat-label>
            <input matInput [(ngModel)]="newCategory.name" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Description (Optional)</mat-label>
            <textarea matInput rows="3" [(ngModel)]="newCategory.description"></textarea>
          </mat-form-field>

          <div
            class="relative flex flex-col items-center justify-center w-full border-2 border-dashed rounded-xl cursor-pointer transition-all duration-200 p-6"
            [ngClass]="dragging ? 'border-[#91203d] bg-pink-50/40' : 'border-gray-300 bg-gray-50 hover:bg-gray-100'"
            (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)" (drop)="onDrop($event)"
            (click)="fileInput.click()">
            <input type="file" accept="image/*" hidden #fileInput (change)="onFileSelect($event)" />

            <ng-container *ngIf="!previewUrl; else previewBlock">
              <mat-icon class="mb-2 text-gray-400">cloud_upload</mat-icon>
              <p class="text-gray-700 text-sm font-medium">
                Click or drag & drop an image here to upload
              </p>
              <p class="text-xs text-gray-500 mt-1">JPG, PNG up to 5MB</p>
            </ng-container>

            <ng-template #previewBlock>
              <div class="flex items-center space-x-3">
                <div class="relative w-14 h-14">
                  <img [src]="previewUrl" alt="Preview"
                    class="w-14 h-14 object-cover rounded-lg border border-gray-200 shadow-sm" />
                  <button (click)="removeImage($event)"
                    class="absolute -top-2 -right-2 flex items-center justify-center w-6 h-6 bg-white border border-gray-300 rounded-full shadow-sm hover:bg-gray-100 transition">
                    <mat-icon
                      class="text-[16px] text-gray-500 flex items-center justify-center leading-none">close</mat-icon>
                  </button>

                </div>

                <div class="flex flex-col">
                  <p class="text-sm text-gray-700 font-medium truncate max-w-[180px]">{{
                    selectedFileName }}</p>
                  <p class="text-xs text-gray-500">Selected image</p>
                </div>
              </div>
            </ng-template>
          </div>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Sub-Category Name (Optional)</mat-label>
            <mat-chip-grid #chipGrid aria-label="Subcategory selection">
              <mat-chip-row *ngFor="let sub of newCategory.subcategories" (removed)="removeSubcategory(sub)"
                class="!bg-pink-100 !text-gray-800 !border !border-[#e4a1b2]">
                {{ sub }}
                <button matChipRemove aria-label="Remove subcategory">
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>

              <input placeholder="Add subcategory..." [matChipInputFor]="chipGrid"
                [matChipInputSeparatorKeyCodes]="separatorKeys" [matChipInputAddOnBlur]="true"
                (matChipInputTokenEnd)="addSubcategoryFromChip($event)" />
            </mat-chip-grid>

          </mat-form-field>
        </div>

        <button (click)="createCategory()"
          class="mt-4 bg-[#91203d] hover:bg-[#701831] text-white font-semibold px-6 py-2 rounded-lg shadow transition-all duration-200">
          Create Category
        </button>
      </div>

      <div class="mt-10">
        <p class="text-lg font-semibold text-gray-900 mb-4 tracking-tight">All Categories</p>

        <div *ngIf="categories.length === 0" class="text-gray-500 text-sm italic">
          No categories available.
        </div>

        <div *ngFor="let cat of categories"
          class="flex justify-between items-center bg-white border border-gray-200 rounded-2xl p-4 mb-3 shadow-sm">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center">
              <img *ngIf="cat.image_url" [src]="cat.image_url" alt="{{ cat.name }}"
                class="w-full h-full object-cover" />
              <mat-icon *ngIf="!cat.image_url" class="text-gray-400 text-2xl">category</mat-icon>
            </div>

            <div>
              <p class="text-[15px] font-semibold text-gray-800">{{ cat.name }}</p>
              <div class="flex flex-wrap gap-1 mt-1">
                <span *ngFor="let sub of cat.subcategories"
                  class="text-xs bg-pink-50 text-[#91203d] px-2.5 py-0.5 rounded-full border border-pink-100">
                  {{ sub.name }}
                </span>
              </div>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button *ngIf="hasPermission('edit_categories')" (click)="openEditDialog(cat)"
              class="text-xs font-medium bg-gray-100 text-gray-800 px-3 py-1.5 rounded-lg border border-gray-200">
              Edit
            </button>
            <button *ngIf="hasPermission('delete_categories')" (click)="deleteCategory(cat.id)"
              class="text-xs font-medium bg-red-50 text-red-600 px-3 py-1.5 rounded-lg border border-red-100">
              Delete
            </button>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="activeTab === 'products'" class="px-6 py-8 space-y-8 overflow-x-hidden">
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
        <p class="text-base font-semibold text-gray-700">Products</p>

     <div class="relative inline-block text-left">
  <button
    mat-icon-button
    [matMenuTriggerFor]="bulkMenu"
    #menuTrigger="matMenuTrigger"
    (menuOpened)="isBulkMenuOpen = true"
    (menuClosed)="isBulkMenuOpen = false"
    class="flex items-center gap-2 bg-[#91203d] text-white px-4 py-2 rounded-md shadow hover:bg-[#a22f4a] transition"
  >
    <span>Bulk Upload</span>
     <mat-icon
      class="transition-transform duration-300"
      [ngClass]="{ 'rotate-180': isBulkMenuOpen }"
    >
      expand_more
    </mat-icon>
  </button>

  <mat-menu #bulkMenu="matMenu" class="rounded-lg shadow-lg">
    <button
      mat-menu-item
      (click)="downloadBulkXlsx()"
      class="!text-gray-700 hover:!bg-gray-100"
    >
      <mat-icon class="!text-[#010101]">download</mat-icon>
      <span>Download Sample XLSX</span>
    </button>

    <button mat-menu-item class="!text-gray-700 hover:!bg-gray-100 relative">
      <mat-icon class="!text-[#010101]">upload</mat-icon>
      <span>Upload Bulk XLSX</span>
      <input
        id="bulkXlsxInput"
        type="file"
        accept=".xlsx"
        class="absolute inset-0 opacity-0 cursor-pointer"
        (change)="onBulkXlsxSelected($event)"
      />
    </button>
  </mat-menu>
</div>


      </div>

      <div class="bg-white border rounded-lg shadow-sm p-6">
        <p class="text-sm font-semibold mb-4 text-gray-700">Create Product</p>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Title</mat-label>
            <input matInput [(ngModel)]="productForm.title" name="title" />
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Price</mat-label>
            <input matInput type="number" [(ngModel)]="productForm.price" name="price" />
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Category</mat-label>
            <select matNativeControl [(ngModel)]="productForm.category_id" (change)="onCategoryChange($event)"
              name="category_id">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
            </select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Sub Category</mat-label>
            <select matNativeControl [(ngModel)]="productForm.sub_category_id" name="sub_category_id"
              [disabled]="!selectedSubcategories.length">
              <option [ngValue]="null">Select</option>
              <option *ngFor="let sub of selectedSubcategories" [value]="sub.id">{{ sub.name }}</option>
            </select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Carats</mat-label>
            <input matInput type="number" step="0.01" min="0" [(ngModel)]="productForm.carats" name="carats"
              placeholder="e.g., 14.22" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Gross Weight</mat-label>
            <input matInput type="number" step="0.01" min="0" [(ngModel)]="productForm.gross_weight" name="gross_weight"
              placeholder="e.g., 22" />
          </mat-form-field>


          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Design code</mat-label>
            <input matInput [(ngModel)]="productForm.design_code" name="design_code" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Purity</mat-label>
            <input matInput [(ngModel)]="productForm.purity" name="purity" />
          </mat-form-field>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>Color</mat-label>
            <input matInput [(ngModel)]="productForm.color" name="color" />
          </mat-form-field>
        </div>
        <mat-form-field appearance="outline" class="w-full mt-4">
          <mat-label>Description</mat-label>
          <textarea matInput rows="3" [(ngModel)]="productForm.description" name="description"></textarea>
        </mat-form-field>
        <div class="mt-4">
          <p class="text-sm font-medium mb-2 text-gray-600">Images (max 8)</p>
          <div
            class="upload-zone border-2 border-dashed rounded-xl p-6 flex flex-col items-center justify-center text-center cursor-pointer transition relative"
            [class.upload-zone--hover]="dragging" (dragover)="onDragOver($event)" (dragleave)="onDragLeave($event)"
            (drop)="onProductDrop($event)">
            <input type="file" multiple accept="image/*" (change)="onProductFilesSelected($event)" class="hidden"
              id="prodFilesInput" />

            <label for="prodFilesInput" class="flex flex-col items-center space-y-2 cursor-pointer select-none">
              <mat-icon class="text-gray-500">cloud_upload</mat-icon>
              <span class="text-sm text-gray-700 font-medium">Drag & Drop or Click to Upload</span>
              <span class="text-xs text-gray-400">Only image files are supported</span>
            </label>

            <div *ngIf="productPreviewUrls.length"
              class="mt-5 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-3 w-full">
              <div *ngFor="let url of productPreviewUrls; let i = index" class="relative group">
                <img [src]="url" class="w-full h-28 object-cover rounded-lg border hover:opacity-90 transition" />
                <button type="button" (click)="removeProductPreview(i)"
                  class="absolute top-1 right-1 bg-white/80 backdrop-blur-sm rounded-full p-1 border opacity-0 group-hover:opacity-100 transition">
                  <mat-icon class="text-sm text-gray-700">close</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>


        <div class="flex justify-end mt-5">
          <button
            class="bg-[#91203d] text-white font-medium px-8 py-2.5 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center hover:bg-[#7d1b35] hover:shadow-md disabled:bg-[#91203d]/70 disabled:cursor-not-allowed disabled:opacity-80 min-w-[140px]"
            [disabled]="isCreating" (click)="createProduct()">
            <ng-container *ngIf="!isCreating">Create</ng-container>

            <ng-container *ngIf="isCreating">
              <svg class="animate-spin h-4 w-4 text-white mr-2 inline-block" xmlns="http://www.w3.org/2000/svg"
                fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
              Creating...
            </ng-container>
          </button>
        </div>

      </div>
      <div class="space-y-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div class="flex items-center gap-3 w-full md:w-1/2">
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Search</mat-label>

              <mat-icon matPrefix class="text-gray-500">search</mat-icon>

              <input matInput [(ngModel)]="productsQuery" (input)="onSearchInput()"
                placeholder="Search by title or description" />

              <button *ngIf="!productsLoading" matSuffix (click)="onSearchProducts()"
                class="text-[#91203d] hover:text-[#a52b4a] transition" mat-icon-button aria-label="Search">
                <mat-icon>arrow_forward</mat-icon>
              </button>

              <div *ngIf="productsLoading" matSuffix class="flex items-center justify-center">
                <svg class="animate-spin h-5 w-5 text-[#91203d]" xmlns="http://www.w3.org/2000/svg" fill="none"
                  viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
              </div>
            </mat-form-field>
          </div>


          <div class="flex items-center gap-3">
            <mat-form-field appearance="outline" class="w-48">
              <mat-label>Category</mat-label>
              <select matNativeControl [(ngModel)]="productsCategoryFilter" (change)="onCategoryFilterChange()">
                <option [ngValue]="null">All categories</option>
                <option *ngFor="let c of categories" [value]="c.slug || c.id">{{ c.name }}</option>
              </select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="w-40">
              <mat-label>Sort</mat-label>
              <select matNativeControl [(ngModel)]="productsSort" (change)="onSortChange()">
                <option value="created_desc">Newest</option>
                <option value="price_asc">Price: Low → High</option>
                <option value="price_desc">Price: High → Low</option>
              </select>
            </mat-form-field>
          </div>
        </div>


        <div class="bg-white border rounded-lg shadow-sm w-full max-w-[650px] mx-auto overflow-hidden">
          <div
            class="overflow-y-auto overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 max-h-[600px]"
            (scroll)="onTableScroll($event)">
            <table class="min-w-[900px] text-sm border-collapse w-full">
              <thead class="bg-gray-50 border-b sticky top-0 z-10">
                <tr>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Image</th>
                  <th class="px-6 py-2 text-left font-medium text-gray-700 w-64 whitespace-nowrap">Title</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Category</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Sub Category</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Price</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Created</th>
                  <th class="px-4 py-2 text-left font-medium text-gray-700 whitespace-nowrap">Actions</th>
                </tr>
              </thead>

              <tbody class="divide-y divide-gray-100">
                <tr *ngFor="let p of products" class="hover:bg-gray-50 transition">
                  <td class="px-4 py-3">
                    <div class="flex items-center gap-2">
                      <img [src]="p.main_image_url || (p.images && p.images[0])"
                        class="w-12 h-12 object-cover rounded border" [matTooltip]="p.title"
                        matTooltipClass="custom-tooltip" />
                      <div *ngIf="p.images?.length > 1" class="flex -space-x-2">
                        <img *ngFor="let img of p.images.slice(1, 3)" [src]="img"
                          class="w-6 h-6 object-cover rounded-full border border-white shadow-sm" />
                      </div>
                    </div>
                  </td>

                  <td class="px-6 py-3 align-top">
                    <div class="font-semibold text-gray-800 truncate max-w-[200px]" [matTooltip]="p.title"
                      matTooltipClass="custom-tooltip">
                      {{ p.title }}
                    </div>
                    <div class="text-xs text-gray-500 mt-1 line-clamp-2" [matTooltip]="p.description"
                      matTooltipClass="custom-tooltip">
                      {{ p.description }}
                    </div>
                    <div *ngIf="p.design_code" class="text-xs text-gray-400 mt-1">
                      Code: {{ p.design_code }}
                    </div>
                  </td>

                  <td class="px-4 py-3 text-gray-700">
                    {{ p.category_name || '—' }}
                  </td>

                  <td class="px-4 py-3 text-gray-700">
                    {{ p.sub_category_name || '—' }}
                  </td>

                  <td class="px-4 py-3 font-medium text-gray-800 whitespace-nowrap">
                    ₹ {{ p.price }}
                  </td>

                  <td class="px-4 py-3 text-gray-500 whitespace-nowrap" [matTooltip]="p.created_at | date: 'medium'">
                    {{ getTimeAgo(p.created_at) }}
                  </td>

                  <td class="px-4 py-3 whitespace-nowrap">
                    <div class="flex items-center gap-2">
                      <button class="p-1.5 hover:bg-gray-100 rounded-full transition" (click)="openEditProductDialog(p)"
                        matTooltip="Edit Product" matTooltipClass="custom-tooltip">
                        <mat-icon class="text-[#91203d]">edit</mat-icon>
                      </button>
                      <button class="p-1.5 hover:bg-gray-100 rounded-full transition" (click)="deleteProduct(p.id)"
                        matTooltip="Delete Product" matTooltipClass="custom-tooltip">
                        <mat-icon class="text-red-600">delete</mat-icon>
                      </button>
                    </div>
                  </td>
                </tr>

                <tr *ngIf="productsLoading && products.length > 0">
                  <td colspan="7" class="px-4 py-4 text-center">
                    <div class="flex items-center justify-center gap-2 text-[#91203d]">
                      <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                      </svg>
                      <span class="text-sm font-medium">Loading more products...</span>
                    </div>
                  </td>
                </tr>

                <tr *ngIf="products.length === 0 && !productsLoading">
                  <td colspan="7" class="px-4 py-6 text-center text-gray-500">
                    No products found
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </div>


  </div>

</div>


<ng-template #editCategoryDialog let-dialogRef>
  <div class="rounded-2xl shadow-lg p-6">
    <p class="!text-lg font-semibold text-gray-800 mb-4">Edit Category</p>

    <mat-form-field appearance="outline" class="w-full mb-3">
      <mat-label>Category Name</mat-label>
      <input matInput [(ngModel)]="editCategory.name" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full mb-3">
      <mat-label>Description</mat-label>
      <textarea matInput [(ngModel)]="editCategory.description" rows="3"></textarea>
    </mat-form-field>

    <div class="mb-4">
      <mat-chip-grid>
        <mat-chip-row *ngFor="let sub of newCategory.subcategories" (removed)="removeSubcategory(sub)">
          {{ sub }}
          <button matChipRemove>
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>
      </mat-chip-grid>


      <mat-form-field appearance="outline" class="w-full mt-2">
        <mat-label>Add subcategory and hit Enter</mat-label>
        <input matInput placeholder="Press Enter to add" (keydown.enter)="addEditSubcategory($event)" />
      </mat-form-field>
    </div>

    <div class="mb-5">
      <label class="block text-sm font-medium text-gray-700 mb-2">Category Image</label>

      <div
        class="relative flex flex-col items-center justify-center w-full border-2 border-dashed rounded-xl cursor-pointer transition-all duration-200 bg-gray-50"
        [ngClass]="dragging ? 'border-[#91203d] bg-pink-50/40' : 'border-gray-300'" (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)" (drop)="onEditDrop($event)" (click)="editFileInput.click()">
        <input type="file" accept="image/*" hidden #editFileInput (change)="onEditFileSelect($event)" />

        <div *ngIf="editPreviewUrl; else noImage"
          class="relative w-24 h-24 rounded-lg overflow-hidden border border-gray-200 shadow-sm">
          <img [src]="editPreviewUrl" alt="Preview" class="object-cover w-full h-full" />
          <button (click)="removeEditImage($event)"
            class="absolute -top-2 -right-2 bg-white border border-gray-300 rounded-full flex items-center justify-center w-5 h-5">
            <mat-icon class="text-[14px] text-gray-500">close</mat-icon>
          </button>
        </div>

        <ng-template #noImage>
          <mat-icon class="mb-1 text-gray-400">cloud_upload</mat-icon>
          <p class="text-gray-500 text-sm font-medium">Click or drop to upload</p>
          <p class="text-xs text-gray-400 mt-0.5">JPG, PNG up to 5MB</p>
        </ng-template>
      </div>
    </div>


    <div class="flex justify-end gap-2 mt-4">
      <div class="flex justify-end gap-3">
        <button type="button" (click)="dialogRef.close()" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 text-sm font-medium
           hover:bg-gray-100 transition-colors duration-150">
          Cancel
        </button>

        <button type="button" (click)="updateCategory(dialogRef)" class="px-4 py-2 rounded-lg bg-indigo-600 text-white text-sm font-medium
           hover:bg-indigo-700 active:bg-indigo-800 transition-colors duration-150">
          Update
        </button>
      </div>

    </div>
  </div>
</ng-template>

<ng-template #editProductDialog let-dialogRef>
  <div class="bg-white border rounded-2xl shadow-lg p-6 max-h-[90vh] overflow-y-auto">
    <p class="text-base font-semibold mb-4 text-gray-800">Edit Product</p>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="editProduct.title" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Price</mat-label>
        <input matInput type="number" [(ngModel)]="editProduct.price" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Category</mat-label>
        <select
          matNativeControl
          [(ngModel)]="editProduct.category_id"
          (change)="onEditCategoryChange($event)"
        >
          <option [ngValue]="null">Select</option>
          <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
        </select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Sub Category</mat-label>
        <select
          matNativeControl
          [(ngModel)]="editProduct.sub_category_id"
          [disabled]="!editSelectedSubcategories.length"
        >
          <option [ngValue]="null">Select</option>
          <option *ngFor="let sub of editSelectedSubcategories" [value]="sub.id">
            {{ sub.name }}
          </option>
        </select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Carats</mat-label>
        <input matInput type="number" step="0.01" [(ngModel)]="editProduct.carats" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Gross Weight</mat-label>
        <input matInput type="number" step="0.01" [(ngModel)]="editProduct.gross_weight" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Design Code</mat-label>
        <input matInput [(ngModel)]="editProduct.design_code" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Purity</mat-label>
        <input matInput [(ngModel)]="editProduct.purity" />
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Color</mat-label>
        <input matInput [(ngModel)]="editProduct.color" />
      </mat-form-field>
    </div>

    <mat-form-field appearance="outline" class="w-full mt-4">
      <mat-label>Description</mat-label>
      <textarea matInput rows="3" [(ngModel)]="editProduct.description"></textarea>
    </mat-form-field>

    <!-- Images -->
    <div class="mt-4">
      <p class="text-sm font-medium mb-2 text-gray-600">Images (max 8)</p>
      <div
        class="upload-zone border-2 border-dashed rounded-xl p-6 flex flex-col items-center justify-center text-center cursor-pointer transition relative"
        [class.upload-zone--hover]="dragging"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onEditDrop($event)"
      >
        <input
          type="file"
          multiple
          accept="image/*"
          (change)="onEditFilesSelected($event)"
          class="hidden"
          id="editFilesInput"
        />

        <label for="editFilesInput" class="flex flex-col items-center space-y-2 cursor-pointer select-none">
          <mat-icon class="text-gray-500">cloud_upload</mat-icon>
          <span class="text-sm text-gray-700 font-medium">Drag & Drop or Click to Upload</span>
          <span class="text-xs text-gray-400">Only image files are supported</span>
        </label>

        <div *ngIf="editPreviewUrls.length" class="mt-5 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-3 w-full">
          <div *ngFor="let url of editPreviewUrls; let i = index" class="relative group">
            <img [src]="url" class="w-full h-28 object-cover rounded-lg border hover:opacity-90 transition" />
            <button
              type="button"
              (click)="removeEditPreview(i)"
              class="absolute top-1 right-1 bg-white/80 backdrop-blur-sm rounded-full p-1 border opacity-0 group-hover:opacity-100 transition"
            >
              <mat-icon class="text-sm text-gray-700">close</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Buttons -->
    <div class="flex justify-end gap-3 mt-5">
      <button
        type="button"
        (click)="dialogRef.close()"
        class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 text-sm font-medium hover:bg-gray-100 transition"
      >
        Cancel
      </button>

      <button
        type="button"
        (click)="updateProduct(dialogRef)"
        class="px-5 py-2 rounded-lg bg-[#91203d] text-white text-sm font-medium hover:bg-[#7d1b35] active:bg-[#6b1930] transition"
        [disabled]="isUpdating"
      >
        <ng-container *ngIf="!isUpdating">Update</ng-container>
        <ng-container *ngIf="isUpdating">
          <svg
            class="animate-spin h-4 w-4 text-white mr-2 inline-block"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
          Updating...
        </ng-container>
      </button>
    </div>
  </div>
</ng-template>
